<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>SL AUTO - Garage Automobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Flatpickr Calendar CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
  <body style="background:#23272a;">
    <div id="page-loader" class="loader-premium">
      <div class="loader-wheel-premium">
        <img src="assets/loader-wheel.svg" alt="Chargement..." />
        <div class="loader-light"></div>
      </div>
    </div>
    <style>
    /* Responsive design pour mobile, tablette et PC */
    @media (max-width: 600px) {
      #devis-popup .devis-container {
        max-width: 98vw;
        margin: 16px 2vw;
        padding: 18px 6vw 18px 6vw;
        border-radius: 12px;
        box-shadow: 0 4px 16px #eab30833;
      }
      #devis-popup .devis-title {
        font-size: 1.3rem;
      }
      #devis-popup input, #devis-popup select, #devis-popup textarea {
        font-size: 1em;
        padding: 9px 8px;
      }
      #devis-popup button[type="submit"] {
        font-size: 1em;
        padding: 10px 0;
      }
    }
    @media (min-width: 601px) and (max-width: 1024px) {
      #devis-popup .devis-container {
        max-width: 90vw;
        margin: 32px auto;
        padding: 28px 8vw 24px 8vw;
        border-radius: 16px;
      }
      #devis-popup .devis-title {
        font-size: 1.7rem;
      }
      #devis-popup input, #devis-popup select, #devis-popup textarea {
        font-size: 1.08em;
        padding: 10px 10px;
      }
      #devis-popup button[type="submit"] {
        font-size: 1.08em;
        padding: 12px 0;
      }
    }
    /* Correction couleur noire pour tous les textes du formulaire devis */
    #devis-popup label,
    #devis-popup .checkbox-group label,
    #devis-popup .vehicule-info {
      color: #000 !important;
    }
    #devis-popup input,
    #devis-popup select,
    #devis-popup textarea {
      color: #000 !important;
      background: rgba(255,255,255,0.98) !important;
    }
    #devis-popup input::placeholder,
    #devis-popup textarea::placeholder {
      color: #000 !important;
      opacity: 1;
    }
    .loader-premium {
      display: flex;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: radial-gradient(ellipse at center, #23272a 80%, #111 100%);
      z-index: 9999;
      justify-content: center;
      align-items: center;
      transition: opacity 0.4s;
      opacity: 1;
    }
    .loader-wheel-premium {
      position: relative;
      width: 110px; height: 110px;
      display: flex; justify-content: center; align-items: center;
    }
    .loader-wheel-premium img {
      width: 90px;
      box-shadow: 0 4px 32px #eab30855, 0 2px 12px #23272a99;
      border-radius: 50%;
      background: #23272a;
      padding: 12px;
      animation: spin 1.1s linear infinite;
    }
    .loader-light {
      position: absolute;
      top: 0; left: 0;
      width: 110px; height: 110px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #eab30844 0deg 60deg, transparent 60deg 360deg);
      animation: rotate-light 1.1s linear infinite;
      pointer-events: none;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes rotate-light { 100% { transform: rotate(360deg); } }
    </style>
    <script>
window.addEventListener('load', function() {
    setTimeout(function() {
        document.getElementById('page-loader').style.opacity = 0;
        setTimeout(function() {
            document.getElementById('page-loader').style.display = 'none';
        }, 400);
    }, 900);
});
document.querySelectorAll('.mechanic-nav a').forEach(link => {
    link.addEventListener('click', function(e) {
        if (this.getAttribute('href') && !this.getAttribute('href').startsWith('#')) {
            document.getElementById('page-loader').style.opacity = 1;
            document.getElementById('page-loader').style.display = 'flex';
        }
    });
});
    </script>
    <header class="mechanic-header">
    <div class="header-content mechanic-header-content">
      <div class="logo mechanic-logo">
  <img src="assets/logo1.png" alt="Logo SL AUTO" class="logo-img">
      </div>
      <h1 class="mechanic-title">SL AUTO 86</h1>
    </div>
        <nav class="mechanic-nav">
  <a href="index.html" class="active">Accueil</a>
  <a href="rdv.html">Prendre rendez-vous</a>
  <a href="contact.html">Contact</a>
        </nav>
    </header>
    <main>
        <section id="hero">
      <video autoplay loop muted playsinline id="hero-bg-video">
        <source src="assets/garage-animated.mp4" type="video/mp4">
      </video>
      <div class="hero-content">
        <h2>Votre garage de confiance</h2>
        <p>Entretien, réparation et expertise automobile à votre service.</p>
  <button class="cta-btn" id="cta-devis">DEVIS</button>
    <!-- Popup DEVIS -->
    <div id="devis-popup" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10000;background:rgba(34,34,34,0.65);justify-content:center;align-items:center;backdrop-filter:blur(2px);">
      <div class="devis-container" style="max-width:650px;width:96vw;margin:auto;background:linear-gradient(135deg,#fffbe6 0%,#fff 100%);border-radius:28px;box-shadow:0 12px 48px #eab30855,0 2px 12px #23272a33;padding:48px 38px 38px 38px;display:flex;flex-direction:column;gap:28px;position:relative;">
        <button id="close-devis-popup" style="position:absolute;top:12px;right:12px;background:#eab308;color:#23272a;border:none;border-radius:8px;padding:4px 12px;font-weight:bold;cursor:pointer;box-shadow:0 2px 8px #23272a22;">X</button>
  <div class="devis-title" style="font-size:2.3rem;font-weight:bold;color:#eab308;text-align:center;margin-bottom:18px;letter-spacing:1px;text-shadow:0 2px 12px #fff8,0 1px 0 #eab30855;">DEVIS GRATUIT - TARIF PIÈCE AUTOMOBILE</div>
        <form class="devis-form" id="devis-form" style="display:flex;flex-direction:column;gap:18px;">
          <div style="display:flex;gap:24px;flex-wrap:wrap;">
            <div style="flex:1 1 220px;min-width:200px;">
              <label for="type-piece" style="font-size:1.08em;">Type de pièce :</label>
              <select id="type-piece" name="type-piece" required style="font-size:1.08em;padding:12px 14px;border-radius:10px;">
                <option value="">Sélectionner...</option>
                <option value="ampoule">Ampoule</option>
                <option value="phare">Phares antibrouillard</option>
                <option value="batterie">Batterie</option>
                <option value="plaquettes">Plaquettes de frein</option>
                <option value="disques">Disques de frein</option>
                <option value="pneus">Pneus</option>
                <option value="embrayage">Embrayage</option>
                <option value="alternateur">Alternateur</option>
                <option value="courroie">Courroie de distribution</option>
                <option value="filtre">Filtre à air</option>
                <option value="huile">Huile moteur</option>
                <option value="bougies">Bougies d'allumage</option>
                <option value="essuieglace">Essuie-glace</option>
                <option value="radiateur">Radiateur</option>
                <option value="pompe">Pompe à eau</option>
              </select>
            </div>
            <div style="flex:1 1 220px;min-width:200px;">
              <label for="immat" style="font-size:1.08em;">Immatriculation :</label>
              <input type="text" id="immat" name="immat" placeholder="AA-123-BB" required style="font-size:1.08em;padding:12px 14px;border-radius:10px;">
              <div id="vehicule-info" class="vehicule-info" style="display:none;background:#fffbe6;border-radius:10px;padding:10px 14px;margin-top:8px;color:#23272a;font-size:1em;box-shadow:0 1px 6px #eab30822;"></div>
              <div id="vehicule-manuel" style="display:none;gap:10px;flex-direction:column;margin-top:8px;">
                <label for="marque" style="font-size:1em;">Marque :</label>
                <input type="text" id="marque" name="marque" placeholder="ex: Peugeot" style="font-size:1em;padding:10px 12px;border-radius:8px;">
                <label for="modele" style="font-size:1em;">Modèle :</label>
                <input type="text" id="modele" name="modele" placeholder="ex: 208" style="font-size:1em;padding:10px 12px;border-radius:8px;">
                <label for="annee" style="font-size:1em;">Année :</label>
                <input type="number" id="annee" name="annee" placeholder="ex: 2019" min="1950" max="2025" style="font-size:1em;padding:10px 12px;border-radius:8px;">
                <label for="motorisation" style="font-size:1em;">Motorisation :</label>
                <input type="text" id="motorisation" name="motorisation" placeholder="ex: Essence, Diesel..." style="font-size:1em;padding:10px 12px;border-radius:8px;">
              </div>
            </div>
          </div>
          <label for="email" style="font-size:1.08em;">Email :</label>
          <input type="email" id="email" name="email" required style="font-size:1.08em;padding:12px 14px;border-radius:10px;">
          <div style="margin-bottom:8px;font-size:1.08em;font-weight:500;color:#23272a;">Sélectionnez les réparations souhaitées :</div>
          <div class="checkbox-group" id="reparations-group" style="display:flex;flex-wrap:wrap;gap:16px 24px;margin-bottom:18px;"></div>
          <div class="total" id="total" style="font-size:1.3em;font-weight:bold;color:#22c55e;text-align:right;margin-top:10px;">Total : 0 €</div>
          <button type="submit" style="width:100%;background:linear-gradient(90deg,#eab308 80%,#facc15 100%);color:#23272a;font-weight:bold;padding:16px 0;border:none;border-radius:12px;font-size:1.15em;box-shadow:0 2px 12px #eab30833;cursor:pointer;transition:background 0.2s;">Obtenir mon devis</button>
        </form>
      </div>
    </div>

    <style>
    .checkbox-group label {
      background: #f8fafc;
      border-radius: 8px;
      border: 1.5px solid #eab30855;
      padding: 8px 14px;
      margin-bottom: 6px;
      box-shadow: 0 1px 6px #eab30822;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .checkbox-group label:hover, .checkbox-group input[type=checkbox]:focus + label {
      border-color: #eab308;
      box-shadow: 0 2px 12px #eab30844;
    }
    .checkbox-group input[type=checkbox] {
      accent-color: #eab308;
      width: 18px;
      height: 18px;
    }
    </style>

    <script>
    // Popup devis ouverture/fermeture
    document.getElementById('cta-devis').onclick = function() {
      document.getElementById('devis-popup').style.display = 'flex';
      document.body.classList.add('no-scroll');
    };
    document.getElementById('close-devis-popup').onclick = function() {
      document.getElementById('devis-popup').style.display = 'none';
      document.body.classList.remove('no-scroll');
    };
    // Réparations disponibles selon le type de pièce
    const reparationsData = {
      ampoule: [
        { label: "Remplacement ampoule", value: "remplacement_ampoule", prix: 15 },
        { label: "Vérification circuit", value: "verif_circuit", prix: 10 }
      ],
      phare: [
        { label: "Remplacement phare", value: "remplacement_phare", prix: 40 },
        { label: "Réglage alignement", value: "reglage_alignement", prix: 20 }
      ],
      batterie: [
        { label: "Remplacement batterie", value: "remplacement_batterie", prix: 35 },
        { label: "Test de charge", value: "test_charge", prix: 12 }
      ],
      plaquettes: [
        { label: "Remplacement plaquettes", value: "remplacement_plaquettes", prix: 45 },
        { label: "Nettoyage étriers", value: "nettoyage_etriers", prix: 18 }
      ],
      disques: [
        { label: "Remplacement disques", value: "remplacement_disques", prix: 60 },
        { label: "Contrôle usure", value: "controle_usure", prix: 10 }
      ],
      pneus: [
        { label: "Montage pneus", value: "montage_pneus", prix: 25 },
        { label: "Équilibrage", value: "equilibrage", prix: 15 }
      ],
      embrayage: [
        { label: "Remplacement embrayage", value: "remplacement_embrayage", prix: 180 },
        { label: "Purge hydraulique", value: "purge_hydraulique", prix: 30 }
      ],
      alternateur: [
        { label: "Remplacement alternateur", value: "remplacement_alternateur", prix: 90 },
        { label: "Test de charge", value: "test_charge_alt", prix: 15 }
      ],
      courroie: [
        { label: "Remplacement courroie", value: "remplacement_courroie", prix: 120 },
        { label: "Contrôle galets", value: "controle_galets", prix: 20 }
      ],
      filtre: [
        { label: "Remplacement filtre à air", value: "remplacement_filtre", prix: 18 },
        { label: "Nettoyage boîtier", value: "nettoyage_boiter", prix: 8 }
      ],
      huile: [
        { label: "Vidange huile moteur", value: "vidange_huile", prix: 35 },
        { label: "Remplacement filtre à huile", value: "remplacement_filtre_huile", prix: 12 }
      ],
      bougies: [
        { label: "Remplacement bougies", value: "remplacement_bougies", prix: 28 },
        { label: "Contrôle allumage", value: "controle_allumage", prix: 10 }
      ],
      essuieglace: [
        { label: "Remplacement essuie-glace", value: "remplacement_essuieglace", prix: 10 },
        { label: "Nettoyage pare-brise", value: "nettoyage_parebrise", prix: 5 }
      ],
      radiateur: [
        { label: "Remplacement radiateur", value: "remplacement_radiateur", prix: 110 },
        { label: "Purge circuit", value: "purge_circuit", prix: 25 }
      ],
      pompe: [
        { label: "Remplacement pompe à eau", value: "remplacement_pompe", prix: 95 },
        { label: "Contrôle étanchéité", value: "controle_etancheite", prix: 15 }
      ]
    };
    const mainOeuvre = 30;
    const typePiece = document.getElementById('type-piece');
    const reparationsGroup = document.getElementById('reparations-group');
    const totalDiv = document.getElementById('total');
    const immatInput = document.getElementById('immat');
    const vehiculeInfoDiv = document.getElementById('vehicule-info');
    // Générer les cases à cocher selon le type de pièce
    typePiece.addEventListener('change', function() {
      reparationsGroup.innerHTML = '';
      const repList = reparationsData[typePiece.value] || [];
      repList.forEach(rep => {
        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = rep.value;
        checkbox.setAttribute('data-prix', rep.prix);
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(rep.label + ' (' + rep.prix + ' €)'));
        reparationsGroup.appendChild(label);
      });
      updateTotal();
    });
    // Calcul du total
    reparationsGroup.addEventListener('change', updateTotal);
    function updateTotal() {
      let total = 0;
      reparationsGroup.querySelectorAll('input[type=checkbox]:checked').forEach(cb => {
        total += parseFloat(cb.getAttribute('data-prix'));
      });
      if(total > 0) total += mainOeuvre;
      totalDiv.textContent = 'Total : ' + total + ' €';
    }
    // API d'immatriculation (mock ou vraie API)
    const manuelDiv = document.getElementById('vehicule-manuel');
    immatInput.addEventListener('blur', function() {
      const immat = immatInput.value.trim();
      if(!immat) {
        vehiculeInfoDiv.style.display = 'none';
        manuelDiv.style.display = 'flex';
        return;
      }
      vehiculeInfoDiv.style.display = 'block';
      vehiculeInfoDiv.textContent = 'Recherche du véhicule...';
      setTimeout(() => {
        if(immat.toUpperCase().startsWith('AA')) {
          vehiculeInfoDiv.textContent = 'Peugeot 208 - Essence - 2019';
          manuelDiv.style.display = 'none';
        } else if(immat.toUpperCase().startsWith('BB')) {
          vehiculeInfoDiv.textContent = 'Renault Clio - Diesel - 2017';
          manuelDiv.style.display = 'none';
        } else {
          vehiculeInfoDiv.textContent = 'Véhicule inconnu. Merci de renseigner les informations ci-dessous.';
          manuelDiv.style.display = 'flex';
        }
      }, 900);
    });
    // Empêcher l'envoi réel du formulaire
    document.getElementById('devis-form').addEventListener('submit', function(e) {
      e.preventDefault();
      alert('Votre demande de devis a bien été envoyée ! Vous recevrez une réponse par email.');
      document.getElementById('devis-form').reset();
      vehiculeInfoDiv.style.display = 'none';
      totalDiv.textContent = 'Total : 0 €';
      reparationsGroup.innerHTML = '';
    });
    </script>
      </div>
        </section>
        <section id="services">
      <h2>Nos Services</h2>
      <div class="services-list">
        <div class="service-card revision-bg">
          <div class="service-card-content">
            <h3>Grosse mécanique</h3>
            <p>Interventions lourdes et techniques réalisées sur des systèmes mécaniques complexes.</p>
          </div>
        </div>
        <div class="service-card diag-bg">
          <div class="service-card-content">
            <h3>Diagnostic</h3>
            <p>Diagnostic électronique et mécanique précis.</p>
          </div>
        </div>
        <div class="service-card carrosserie-bg">
          <div class="service-card-content">
            <h3>Révision</h3>
            <p>Entretien complet et contrôle technique.</p>
          </div>
        </div>
      </div>
        </section>
  <!-- Section 'Planning des rendez-vous' supprimée -->
    </main>
  <!-- Footer SL AUTO -->
  <footer id="footer-sl-auto" style="position:relative;display:flex;flex-direction:column;align-items:center;gap:8px;min-height:60px;background:#23272a;box-shadow:0 -2px 12px #23272a33;margin-top:0;width:100vw;padding:0 0 16px 0;">
    <p style="color:#fff;font-weight:bold;margin-bottom:0.5em;">&copy; 2025 SL AUTO - Tous droits réservés</p>
    <a href="https://www.facebook.com/profile.php?id=100089297584649" target="_blank" id="footer-facebook-link" style="position:absolute;right:24px;bottom:12px;display:inline-block;text-decoration:none;overflow:hidden;">
      <span id="footer-facebook-btn" style="display:inline-block;font-family:'Segoe UI',Arial,sans-serif;font-weight:bold;font-size:1.25em;color:#eab308;background:#23272a;border:2px solid #fff;border-radius:18px;padding:7px 22px 7px 22px;box-shadow:0 2px 8px #111a;letter-spacing:0.04em;transition:background 0.2s, box-shadow 0.3s, transform 0.4s cubic-bezier(.4,2,.6,1);position:relative;overflow:hidden;">Facebook</span>
    </a>
    <script>
    // Animation pro sur clic Facebook footer
    document.addEventListener('DOMContentLoaded', function() {
      var fbBtn = document.getElementById('footer-facebook-btn');
      if(fbBtn) {
        fbBtn.addEventListener('click', function(e) {
          // Ripple
          var ripple = document.createElement('span');
          ripple.style.position = 'absolute';
          ripple.style.left = (e.offsetX-20) + 'px';
          ripple.style.top = (e.offsetY-20) + 'px';
          ripple.style.width = ripple.style.height = '40px';
          ripple.style.background = 'rgba(234,179,8,0.25)';
          ripple.style.borderRadius = '50%';
          ripple.style.pointerEvents = 'none';
          ripple.style.transform = 'scale(0)';
          ripple.style.transition = 'transform 0.5s cubic-bezier(.4,2,.6,1), opacity 0.5s';
          fbBtn.appendChild(ripple);
          setTimeout(function(){
            ripple.style.transform = 'scale(2.5)';
            ripple.style.opacity = '0';
          }, 10);
          setTimeout(function(){
            if(ripple.parentNode) ripple.parentNode.removeChild(ripple);
          }, 520);
          // Rotation
          fbBtn.style.transform = 'rotate(-8deg) scale(1.08)';
          setTimeout(function(){
            fbBtn.style.transform = '';
          }, 420);
        });
        // Effet hover visible mais discret
        fbBtn.addEventListener('mouseenter', function() {
          fbBtn.style.background = '#eab308';
          fbBtn.style.color = '#23272a';
        });
        fbBtn.addEventListener('mouseleave', function() {
          fbBtn.style.background = '#23272a';
          fbBtn.style.color = '#eab308';
        });
      }
    });
    </script>
    <style>
    @media (max-width: 600px) {
      #footer-sl-auto {
        min-height: 70px !important;
        padding-bottom: 32px !important;
      }
      #footer-sl-auto p {
        font-size: 1em !important;
        text-align: center;
      }
      #footer-facebook-link {
        position: static !important;
        margin-top: 8px !important;
        display: block !important;
        text-align: center !important;
      }
      #footer-facebook-link span {
        font-size: 1em !important;
        padding: 7px 16px 7px 16px !important;
      }
    }
    @media (min-width: 601px) and (max-width: 1024px) {
      #footer-sl-auto {
        min-height: 65px !important;
        padding-bottom: 24px !important;
      }
      #footer-sl-auto p {
        font-size: 1.1em !important;
      }
      #footer-facebook-link span {
        font-size: 1.1em !important;
        padding: 7px 18px 7px 18px !important;
      }
    }
    </style>
  </footer>
    <script src="js/main.js"></script>
</body>
<!-- Flatpickr Calendar JS + French locale -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>
<script>
// --- Gestion avancée des créneaux de rendez-vous ---
const SERVICE_DURATIONS = {
  'Révision': 5,
  'Diagnostic': 2,
  'Carrosserie': 12
};

function getReservedSlotsWithDuration() {
  const rdvs = JSON.parse(localStorage.getItem('rdvs') || '[]');
  // On ne prend que les rendez-vous validés
  return rdvs.filter(r => r.statut === 'validé').map(r => {
    const start = new Date(r.date.replace(' ', 'T'));
    const duration = SERVICE_DURATIONS[r.service] || 1;
    return {
      start,
      end: new Date(start.getTime() + duration * 60 * 60 * 1000)
    };
  });
}

function isSlotAvailable(date, service) {
  // Jour ouvré ?
  const day = date.getDay();
  if (day === 0 || day === 6) return false; // 0=dimanche, 6=samedi
  // Heure ouvrée ?
  const hour = date.getHours();
  if (hour < 9 || hour >= 18) return false;
  // Délai minimum 24h
  const now = new Date();
  if (date.getTime() < now.getTime() + 24*60*60*1000) return false;
  // Doit finir avant 18h
  const duration = SERVICE_DURATIONS[service] || 1;
  const slotStart = date;
  const slotEnd = new Date(slotStart.getTime() + duration * 60 * 60 * 1000);
  if (slotEnd.getHours() > 18 || (slotEnd.getHours() === 18 && slotEnd.getMinutes() > 0)) return false;
  // On ne bloque PAS les créneaux déjà demandés, seulement ceux validés (voir getReservedSlotsWithDuration)
  return true;
}

let selectedService = 'Révision';


const fp = flatpickr("#date", {
  enableTime: true,
  dateFormat: "Y-m-d H:i",
  time_24hr: true,
  minuteIncrement: 15,
  locale: flatpickr.l10ns.fr,
  minDate: "today",
  // Pas de disable JS, tout est vérifié à la soumission
});

// Validation côté JS du créneau choisi lors de la soumission du formulaire
const form = document.getElementById('rdv-form');
if(form) {
  form.addEventListener('submit', function(e) {
    const dateInput = document.getElementById('date');
    const serviceInput = document.getElementById('service');
    const dateStr = dateInput.value;
    const service = serviceInput.value;
    if(dateStr && service) {
      const date = new Date(dateStr.replace(' ', 'T'));
      // Vérification détaillée
      const day = date.getDay();
      if (day === 0 || day === 6) {
        e.preventDefault();
        alert("❌ Les rendez-vous ne sont possibles que du lundi au vendredi.");
        return false;
      }
      const hour = date.getHours();
      if (hour < 9) {
        e.preventDefault();
        alert("❌ Les rendez-vous ne peuvent pas être pris avant 9h du matin.");
        return false;
      }
      // Délai minimum 24h
      const now = new Date();
      if (date.getTime() < now.getTime() + 24*60*60*1000) {
        e.preventDefault();
        alert("❌ Vous devez réserver au moins 24h à l'avance.");
        return false;
      }
      // Doit finir avant 18h, et pas commencer trop tard
      const duration = SERVICE_DURATIONS[service] || 1;
      const slotEnd = new Date(date.getTime() + duration * 60 * 60 * 1000);
      if (slotEnd.getHours() > 18 || (slotEnd.getHours() === 18 && slotEnd.getMinutes() > 0)) {
        e.preventDefault();
        alert("❌ Ce service est trop long pour finir avant 18h. Merci de choisir un créneau plus tôt.");
        return false;
      }
      // Interdiction de commencer un service moins de 2h avant la fermeture
      if (hour >= 16) {
        // Pour tous les services, on interdit de commencer à partir de 16h (18h-2h)
        e.preventDefault();
        alert("❌ Vous ne pouvez pas réserver un créneau moins de 2h avant la fermeture (18h). Merci de choisir un horaire plus tôt.");
        return false;
      }
      // On ne bloque PAS les créneaux déjà demandés, seulement ceux validés
      // (la logique de chevauchement n'est appliquée qu'aux validés)
    }
  });
}
</script>
<script>
// Désactive clic droit
window.addEventListener('contextmenu', function(e) { e.preventDefault(); });
// Désactive F12, Ctrl+Shift+I, Ctrl+U
window.addEventListener('keydown', function(e) {
    if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i') || (e.ctrlKey && e.key.toLowerCase() === 'u')) {
        e.preventDefault();
        return false;
    }
});
</script>
<!-- Popup formulaire RDV -->

<style>
#rdv-popup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  z-index: 99999;
  justify-content: center;
  align-items: center;
  background: radial-gradient(ellipse at center, #23272a 80%, #111 100%);
  animation: fadeInBg 0.5s;
}
@keyframes fadeInBg { from { opacity: 0; } to { opacity: 1; } }
.rdv-popup-content {
  background: linear-gradient(135deg, #fffbe6 0%, #fff 100%);
  padding: 38px 24px 28px 24px;
  border-radius: 22px;
  max-width: 420px;
  width: 98vw;
  box-shadow: 0 6px 36px #eab30888, 0 2px 12px #23272a55;
  position: relative;
  animation: popupAppear 0.5s;
}
@keyframes popupAppear { from { transform: scale(0.92); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.rdv-popup-content h2 {
  color: #23272a;
  text-align: center;
  margin-bottom: 22px;
  font-size: 1.5rem;
  font-weight: 700;
  letter-spacing: 1px;
}
#close-rdv-popup {
  position: absolute;
  top: 12px; right: 12px;
  background: #eab308;
  color: #23272a;
  border: none;
  border-radius: 8px;
  padding: 4px 12px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 2px 8px #23272a22;
  transition: background 0.2s;
}
#close-rdv-popup:hover {
  background: #ffd700;
}
#rdv-form-index {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
#rdv-form-index input,
#rdv-form-index select {
  width: 100%;
  padding: 10px 14px 10px 38px;
  border: 1.5px solid #eab308;
  border-radius: 10px;
  background: #fff;
  font-size: 1rem;
  color: #23272a;
  box-shadow: 0 1px 6px #eab30822;
  transition: border 0.2s, box-shadow 0.2s;
  outline: none;
  position: relative;
}
#rdv-form-index input:focus,
#rdv-form-index select:focus {
  border-color: #23272a;
  box-shadow: 0 2px 12px #eab30844;
}
#rdv-form-index input[type="datetime-local"]::-webkit-calendar-picker-indicator {
  filter: invert(0.7) sepia(1) saturate(5) hue-rotate(10deg);
}
#rdv-form-index button[type="submit"] {
  width: 100%;
  background: linear-gradient(90deg, #eab308 60%, #ffd700 100%);
  color: #23272a;
  font-weight: bold;
  padding: 12px 0;
  border: none;
  border-radius: 10px;
  font-size: 1.1rem;
  box-shadow: 0 2px 12px #eab30855;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
}
#rdv-form-index button[type="submit"]:hover {
  background: linear-gradient(90deg, #ffd700 60%, #eab308 100%);
  box-shadow: 0 4px 18px #eab30899;
}
.rdv-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.1em;
  color: #eab308;
  pointer-events: none;
}
.rdv-field {
  position: relative;
}
</style>
<div id="rdv-popup">
  <div class="rdv-popup-content">
    <div style="max-height:80vh;overflow-y:auto;padding-bottom:12px;">
      <button id="close-rdv-popup">X</button>
      <h2>Devis</h2>
      <form id="rdv-form-index">
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#352c10;font-size:1em;font-weight:500;">Votre nom de famille.</span>
        <label for="lastname-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Nom :</label>
        <input type="text" id="lastname-index" name="lastname" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Votre prénom usuel.</span>
        <label for="firstname-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Prénom :</label>
        <input type="text" id="firstname-index" name="firstname" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Marque et modèle du véhicule (ex : Peugeot 208).</span>
        <label for="vehicule-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Véhicule :</label>
        <input type="text" id="vehicule-index" name="vehicule" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Type de véhicule (citadine, SUV, utilitaire...)</span>
        <label for="categorie-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Catégorie :</label>
        <select id="categorie-index" name="categorie" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
          <option value="">Catégorie...</option>
          <option value="Citadine">Citadine</option>
          <option value="Berline">Berline</option>
          <option value="SUV">SUV</option>
          <option value="Utilitaire">Utilitaire</option>
          <option value="Autre">Autre</option>
        </select>
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Pour recevoir la confirmation et les infos du rendez-vous.</span>
        <label for="email-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Email :</label>
        <input type="email" id="email-index" name="email" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Pour vous joindre en cas de besoin ou rappel.</span>
        <label for="phone-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Téléphone :</label>
        <input type="tel" id="phone-index" name="phone" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Choisissez le type d’intervention souhaitée.</span>
        <label for="service-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Service :</label>
        <select id="service-index" name="service" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
          <option value="">Service...</option>
          <option value="Révision">Révision</option>
          <option value="Diagnostic">Diagnostic</option>
          <option value="Carrosserie">Carrosserie</option>
        </select>
      </div>
      <div style="margin-bottom:18px;padding:12px 10px;background:#fffbe6;border-radius:12px;border:1px solid #eab30833;box-shadow:0 2px 8px #eab30822;display:flex;flex-direction:column;align-items:stretch;gap:6px;">
        <span style="color:#eab308;font-size:1em;font-weight:500;">Sélectionnez le créneau souhaité (du lundi au vendredi, 9h-18h).</span>
        <label for="date-index" style="font-weight:500;color:#23272a;font-size:1.05em;">Date et heure :</label>
        <input type="datetime-local" id="date-index" name="date" required style="padding:10px 12px;border-radius:8px;border:1px solid #eab30855;font-size:1em;background:#f8fafc;color:#23272a;width:100%;box-sizing:border-box;">
      </div>
      <button type="submit" style="width:100%;background:linear-gradient(90deg,#eab308 80%,#facc15 100%);color:#23272a;font-weight:bold;padding:12px 0;border:none;border-radius:8px;font-size:1.1em;box-shadow:0 2px 12px #eab30833;cursor:pointer;transition:background 0.2s;">Valider</button>
    </form>
    </div>
  </div>
</div>
<script>
document.getElementById('cta-rdv-popup').addEventListener('click', function() {
  document.getElementById('rdv-popup').style.display = 'flex';
});
document.getElementById('close-rdv-popup').addEventListener('click', function() {
  document.getElementById('rdv-popup').style.display = 'none';
});
document.getElementById('rdv-form-index').addEventListener('submit', function(e) {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(this));
  fetch('http://localhost:3001/rdvs', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  })
  .then(res => {
    if(!res.ok) throw new Error('Erreur lors de la prise de rendez-vous');
    return res.json();
  })
  .then(rdv => {
    document.getElementById('rdv-popup').style.display = 'none';
    showRdvConfirmation(new Date(rdv.date).toLocaleString('fr-FR'));
  })
  .catch(err => {
    alert('Erreur serveur: ' + err.message);
  });
});
</script>
</body>
</html>